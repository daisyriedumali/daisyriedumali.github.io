<!DOCTYPE html>
<html>
<head>
	<title>Facebook Login JavaScript Example</title>
	<meta charset="UTF-8">
	<script src="js/react.js"></script>
	<script src="js/react-dom.js"></script>
	<script src="js/browser.min.js"></script>
	<script src="js/fb-login.js"></script>
</head>
<body>

	<!--
	  Below we include the Login Button social plugin. This button uses
	  the JavaScript SDK to present a graphical Login button that triggers
	  the FB.login() function when clicked.
	-->
	

	<div id="status">
	</div>
	
	<section id="react-mount">
	</section>

	<script type="text/babel">
		var TeembrNicheMiner = React.createClass({
			testAPI: function() {
				console.log('Welcome!  Fetching your information.... ');
				FB.api('/me', function(response) {
				ISLOGIN = true;
				USER_ID = response.id;
				USER_NAME = response.name;

				console.log('Successful login for: ' + response.name);
				document.getElementById('status').innerHTML =
					'Thanks for logging in, ' + response.name + '!';
				});
		    },

			statusChangeCallback: function(response) {
		      console.log('statusChangeCallback');
		      console.log(response);
		      // The response object is returned with a status field that lets the
		      // app know the current login status of the person.
		      // Full docs on the response object can be found in the documentation
		      // for FB.getLoginStatus().
		      if (response.status === 'connected') {
		        // Logged into your app and Facebook.
		        this.testAPI();
		      } else if (response.status === 'not_authorized') {
		        // The person is logged into Facebook, but not your app.
		        document.getElementById('status').innerHTML = 'Please log ' + 'into this app.';
		      } else {
		        // The person is not logged into Facebook, so we're not sure if
		        // they are logged into this app or not.
		        document.getElementById('status').innerHTML = 'Please log ' + 'into Facebook.';
		      }
		    },

			checkLoginState: function() {
      			FB.getLoginStatus(function(response) {
			        this.statusChangeCallback(response);
			    });
    		},

    		componentDidMount: function(){
    			this.checkLoginState();
    		},

			render: function(){
				var msg;
				if(ISLOGIN)
					msg = "Hello, "+USER_NAME;
				else
					msg = "Please login to facebook!";

				return (
					<div>	
						Welcome to TeembrNicheMiner!
						<p>{msg}</p>
					</div>
				);
			}
		});

		ReactDOM.render(<TeembrNicheMiner />, document.getElementById('react-mount'));
	</script>
</body>
</html>